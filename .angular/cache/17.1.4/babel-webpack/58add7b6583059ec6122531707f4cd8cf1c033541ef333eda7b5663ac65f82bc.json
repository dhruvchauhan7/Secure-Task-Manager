{"ast":null,"code":"import { computed, signal } from '@angular/core';\nimport * as i0 from \"@angular/core\";\nexport class AuthService {\n  constructor() {\n    this.tokenKey = 'accessToken';\n    // token signal\n    this._token = signal(this.readToken());\n    // derived computed values\n    this.token = computed(() => this._token());\n    this.isLoggedIn = computed(() => !!this._token() && !this.isTokenExpired(this._token()));\n    this.user = computed(() => {\n      const t = this._token();\n      return t ? this.decodeToken(t) : null;\n    });\n  }\n  // ✅ used by app.component.ts in your code\n  getUser() {\n    return this.user();\n  }\n  // ✅ called by LoginComponent\n  setToken(token) {\n    localStorage.setItem(this.tokenKey, token);\n    this._token.set(token);\n  }\n  logout() {\n    localStorage.removeItem(this.tokenKey);\n    this._token.set(null);\n  }\n  getAuthHeader() {\n    const t = this._token();\n    return t ? `Bearer ${t}` : null;\n  }\n  // ---------- helpers ----------\n  readToken() {\n    return localStorage.getItem(this.tokenKey);\n  }\n  decodeToken(token) {\n    try {\n      const payloadPart = token.split('.')[1];\n      if (!payloadPart) return null;\n      // base64url -> base64\n      const base64 = payloadPart.replace(/-/g, '+').replace(/_/g, '/');\n      const json = decodeURIComponent(atob(base64).split('').map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));\n      return JSON.parse(json);\n    } catch {\n      return null;\n    }\n  }\n  isTokenExpired(token) {\n    const decoded = this.decodeToken(token);\n    if (!decoded?.exp) return true;\n    const nowSeconds = Math.floor(Date.now() / 1000);\n    return decoded.exp <= nowSeconds;\n  }\n  static {\n    this.ɵfac = function AuthService_Factory(t) {\n      return new (t || AuthService)();\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["computed","signal","AuthService","constructor","tokenKey","_token","readToken","token","isLoggedIn","isTokenExpired","user","t","decodeToken","getUser","setToken","localStorage","setItem","set","logout","removeItem","getAuthHeader","getItem","payloadPart","split","base64","replace","json","decodeURIComponent","atob","map","c","charCodeAt","toString","slice","join","JSON","parse","decoded","exp","nowSeconds","Math","floor","Date","now","factory","ɵfac","providedIn"],"sources":["E:\\Practice\\secure-task-manager\\apps\\dashboard\\src\\app\\auth\\auth.service.ts"],"sourcesContent":["import { Injectable, computed, signal } from '@angular/core';\r\n\r\nexport type JwtPayload = {\r\n  sub: string;\r\n  email: string;\r\n  role: 'OWNER' | 'ADMIN' | 'VIEWER' | string;\r\n  orgId: string;\r\n  iat: number;\r\n  exp: number;\r\n};\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class AuthService {\r\n  private readonly tokenKey = 'accessToken';\r\n\r\n  // token signal\r\n  private readonly _token = signal<string | null>(this.readToken());\r\n\r\n  // derived computed values\r\n  readonly token = computed(() => this._token());\r\n  readonly isLoggedIn = computed(() => !!this._token() && !this.isTokenExpired(this._token()!));\r\n  readonly user = computed(() => {\r\n    const t = this._token();\r\n    return t ? this.decodeToken(t) : null;\r\n  });\r\n\r\n  // ✅ used by app.component.ts in your code\r\n  getUser(): JwtPayload | null {\r\n    return this.user();\r\n  }\r\n\r\n  // ✅ called by LoginComponent\r\n  setToken(token: string) {\r\n    localStorage.setItem(this.tokenKey, token);\r\n    this._token.set(token);\r\n  }\r\n\r\n  logout() {\r\n    localStorage.removeItem(this.tokenKey);\r\n    this._token.set(null);\r\n  }\r\n\r\n  getAuthHeader(): string | null {\r\n    const t = this._token();\r\n    return t ? `Bearer ${t}` : null;\r\n  }\r\n\r\n  // ---------- helpers ----------\r\n  private readToken(): string | null {\r\n    return localStorage.getItem(this.tokenKey);\r\n  }\r\n\r\n  private decodeToken(token: string): JwtPayload | null {\r\n    try {\r\n      const payloadPart = token.split('.')[1];\r\n      if (!payloadPart) return null;\r\n\r\n      // base64url -> base64\r\n      const base64 = payloadPart.replace(/-/g, '+').replace(/_/g, '/');\r\n      const json = decodeURIComponent(\r\n        atob(base64)\r\n          .split('')\r\n          .map((c) => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))\r\n          .join('')\r\n      );\r\n\r\n      return JSON.parse(json) as JwtPayload;\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  private isTokenExpired(token: string): boolean {\r\n    const decoded = this.decodeToken(token);\r\n    if (!decoded?.exp) return true;\r\n    const nowSeconds = Math.floor(Date.now() / 1000);\r\n    return decoded.exp <= nowSeconds;\r\n  }\r\n}\r\n"],"mappings":"AAAA,SAAqBA,QAAQ,EAAEC,MAAM,QAAQ,eAAe;;AAY5D,OAAM,MAAOC,WAAW;EADxBC,YAAA;IAEmB,KAAAC,QAAQ,GAAG,aAAa;IAEzC;IACiB,KAAAC,MAAM,GAAGJ,MAAM,CAAgB,IAAI,CAACK,SAAS,EAAE,CAAC;IAEjE;IACS,KAAAC,KAAK,GAAGP,QAAQ,CAAC,MAAM,IAAI,CAACK,MAAM,EAAE,CAAC;IACrC,KAAAG,UAAU,GAAGR,QAAQ,CAAC,MAAM,CAAC,CAAC,IAAI,CAACK,MAAM,EAAE,IAAI,CAAC,IAAI,CAACI,cAAc,CAAC,IAAI,CAACJ,MAAM,EAAG,CAAC,CAAC;IACpF,KAAAK,IAAI,GAAGV,QAAQ,CAAC,MAAK;MAC5B,MAAMW,CAAC,GAAG,IAAI,CAACN,MAAM,EAAE;MACvB,OAAOM,CAAC,GAAG,IAAI,CAACC,WAAW,CAACD,CAAC,CAAC,GAAG,IAAI;IACvC,CAAC,CAAC;;EAEF;EACAE,OAAOA,CAAA;IACL,OAAO,IAAI,CAACH,IAAI,EAAE;EACpB;EAEA;EACAI,QAAQA,CAACP,KAAa;IACpBQ,YAAY,CAACC,OAAO,CAAC,IAAI,CAACZ,QAAQ,EAAEG,KAAK,CAAC;IAC1C,IAAI,CAACF,MAAM,CAACY,GAAG,CAACV,KAAK,CAAC;EACxB;EAEAW,MAAMA,CAAA;IACJH,YAAY,CAACI,UAAU,CAAC,IAAI,CAACf,QAAQ,CAAC;IACtC,IAAI,CAACC,MAAM,CAACY,GAAG,CAAC,IAAI,CAAC;EACvB;EAEAG,aAAaA,CAAA;IACX,MAAMT,CAAC,GAAG,IAAI,CAACN,MAAM,EAAE;IACvB,OAAOM,CAAC,GAAG,UAAUA,CAAC,EAAE,GAAG,IAAI;EACjC;EAEA;EACQL,SAASA,CAAA;IACf,OAAOS,YAAY,CAACM,OAAO,CAAC,IAAI,CAACjB,QAAQ,CAAC;EAC5C;EAEQQ,WAAWA,CAACL,KAAa;IAC/B,IAAI;MACF,MAAMe,WAAW,GAAGf,KAAK,CAACgB,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;MACvC,IAAI,CAACD,WAAW,EAAE,OAAO,IAAI;MAE7B;MACA,MAAME,MAAM,GAAGF,WAAW,CAACG,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,CAACA,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC;MAChE,MAAMC,IAAI,GAAGC,kBAAkB,CAC7BC,IAAI,CAACJ,MAAM,CAAC,CACTD,KAAK,CAAC,EAAE,CAAC,CACTM,GAAG,CAAEC,CAAC,IAAK,GAAG,GAAG,CAAC,IAAI,GAAGA,CAAC,CAACC,UAAU,CAAC,CAAC,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,EAAEC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CACjEC,IAAI,CAAC,EAAE,CAAC,CACZ;MAED,OAAOC,IAAI,CAACC,KAAK,CAACV,IAAI,CAAe;IACvC,CAAC,CAAC,MAAM;MACN,OAAO,IAAI;IACb;EACF;EAEQjB,cAAcA,CAACF,KAAa;IAClC,MAAM8B,OAAO,GAAG,IAAI,CAACzB,WAAW,CAACL,KAAK,CAAC;IACvC,IAAI,CAAC8B,OAAO,EAAEC,GAAG,EAAE,OAAO,IAAI;IAC9B,MAAMC,UAAU,GAAGC,IAAI,CAACC,KAAK,CAACC,IAAI,CAACC,GAAG,EAAE,GAAG,IAAI,CAAC;IAChD,OAAON,OAAO,CAACC,GAAG,IAAIC,UAAU;EAClC;;;uBAjEWrC,WAAW;IAAA;EAAA;;;aAAXA,WAAW;MAAA0C,OAAA,EAAX1C,WAAW,CAAA2C,IAAA;MAAAC,UAAA,EADE;IAAM;EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
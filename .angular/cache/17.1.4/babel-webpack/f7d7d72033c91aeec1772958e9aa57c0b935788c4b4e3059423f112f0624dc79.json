{"ast":null,"code":"import { computed, signal } from '@angular/core';\nimport * as i0 from \"@angular/core\";\nexport class AuthService {\n  constructor() {\n    this.tokenSig = signal(localStorage.getItem('accessToken'));\n    this.token = computed(() => this.tokenSig());\n    this.userSig = signal(this.decode(this.tokenSig()));\n    this.user = computed(() => this.userSig());\n    this.isLoggedIn = computed(() => !!this.tokenSig());\n    this.canWrite = computed(() => {\n      const u = this.userSig();\n      return !!u && (u.role === 'OWNER' || u.role === 'ADMIN');\n    });\n  }\n  /** Used by LoginComponent */\n  setToken(token) {\n    localStorage.setItem('accessToken', token);\n    this.tokenSig.set(token);\n    this.userSig.set(this.decode(this.tokenSig()));\n  }\n  /** Used by header Logout button */\n  logout() {\n    localStorage.removeItem('accessToken');\n    this.tokenSig.set(null);\n    this.userSig.set(null);\n  }\n  /** Used by AppComponent */\n  getUser() {\n    return this.userSig();\n  }\n  decode(token) {\n    if (!token) return null;\n    try {\n      const payload = token.split('.')[1];\n      const json = decodeURIComponent(atob(payload.replace(/-/g, '+').replace(/_/g, '/')).split('').map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));\n      return JSON.parse(json);\n    } catch {\n      return null;\n    }\n  }\n  static {\n    this.ɵfac = function AuthService_Factory(t) {\n      return new (t || AuthService)();\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["computed","signal","AuthService","constructor","tokenSig","localStorage","getItem","token","userSig","decode","user","isLoggedIn","canWrite","u","role","setToken","setItem","set","logout","removeItem","getUser","payload","split","json","decodeURIComponent","atob","replace","map","c","charCodeAt","toString","slice","join","JSON","parse","factory","ɵfac","providedIn"],"sources":["E:\\Practice\\secure-task-manager\\apps\\dashboard\\src\\app\\auth\\auth.service.ts"],"sourcesContent":["import { Injectable, computed, signal } from '@angular/core';\r\n\r\nexport type Role = 'OWNER' | 'ADMIN' | 'VIEWER';\r\n\r\nexport type JwtUser = {\r\n  sub: string;\r\n  email: string;\r\n  role: Role;\r\n  orgId: string;\r\n  iat?: number;\r\n  exp?: number;\r\n};\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class AuthService {\r\n  private readonly tokenSig = signal<string | null>(localStorage.getItem('accessToken'));\r\n  readonly token = computed(() => this.tokenSig());\r\n\r\n  private readonly userSig = signal<JwtUser | null>(this.decode(this.tokenSig()));\r\n  readonly user = computed(() => this.userSig());\r\n\r\n  isLoggedIn = computed(() => !!this.tokenSig());\r\n  canWrite = computed(() => {\r\n    const u = this.userSig();\r\n    return !!u && (u.role === 'OWNER' || u.role === 'ADMIN');\r\n  });\r\n\r\n  /** Used by LoginComponent */\r\n  setToken(token: string) {\r\n    localStorage.setItem('accessToken', token);\r\n    this.tokenSig.set(token);\r\n    this.userSig.set(this.decode(this.tokenSig()));\r\n  }\r\n\r\n  /** Used by header Logout button */\r\n  logout() {\r\n    localStorage.removeItem('accessToken');\r\n    this.tokenSig.set(null);\r\n    this.userSig.set(null);\r\n  }\r\n\r\n  /** Used by AppComponent */\r\n  getUser() {\r\n    return this.userSig();\r\n  }\r\n\r\n  private decode(token: string | null): JwtUser | null {\r\n    if (!token) return null;\r\n    try {\r\n      const payload = token.split('.')[1];\r\n      const json = decodeURIComponent(\r\n        atob(payload.replace(/-/g, '+').replace(/_/g, '/'))\r\n          .split('')\r\n          .map((c) => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))\r\n          .join('')\r\n      );\r\n      return JSON.parse(json) as JwtUser;\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n}\r\n"],"mappings":"AAAA,SAAqBA,QAAQ,EAAEC,MAAM,QAAQ,eAAe;;AAc5D,OAAM,MAAOC,WAAW;EADxBC,YAAA;IAEmB,KAAAC,QAAQ,GAAGH,MAAM,CAAgBI,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC,CAAC;IAC7E,KAAAC,KAAK,GAAGP,QAAQ,CAAC,MAAM,IAAI,CAACI,QAAQ,EAAE,CAAC;IAE/B,KAAAI,OAAO,GAAGP,MAAM,CAAiB,IAAI,CAACQ,MAAM,CAAC,IAAI,CAACL,QAAQ,EAAE,CAAC,CAAC;IACtE,KAAAM,IAAI,GAAGV,QAAQ,CAAC,MAAM,IAAI,CAACQ,OAAO,EAAE,CAAC;IAE9C,KAAAG,UAAU,GAAGX,QAAQ,CAAC,MAAM,CAAC,CAAC,IAAI,CAACI,QAAQ,EAAE,CAAC;IAC9C,KAAAQ,QAAQ,GAAGZ,QAAQ,CAAC,MAAK;MACvB,MAAMa,CAAC,GAAG,IAAI,CAACL,OAAO,EAAE;MACxB,OAAO,CAAC,CAACK,CAAC,KAAKA,CAAC,CAACC,IAAI,KAAK,OAAO,IAAID,CAAC,CAACC,IAAI,KAAK,OAAO,CAAC;IAC1D,CAAC,CAAC;;EAEF;EACAC,QAAQA,CAACR,KAAa;IACpBF,YAAY,CAACW,OAAO,CAAC,aAAa,EAAET,KAAK,CAAC;IAC1C,IAAI,CAACH,QAAQ,CAACa,GAAG,CAACV,KAAK,CAAC;IACxB,IAAI,CAACC,OAAO,CAACS,GAAG,CAAC,IAAI,CAACR,MAAM,CAAC,IAAI,CAACL,QAAQ,EAAE,CAAC,CAAC;EAChD;EAEA;EACAc,MAAMA,CAAA;IACJb,YAAY,CAACc,UAAU,CAAC,aAAa,CAAC;IACtC,IAAI,CAACf,QAAQ,CAACa,GAAG,CAAC,IAAI,CAAC;IACvB,IAAI,CAACT,OAAO,CAACS,GAAG,CAAC,IAAI,CAAC;EACxB;EAEA;EACAG,OAAOA,CAAA;IACL,OAAO,IAAI,CAACZ,OAAO,EAAE;EACvB;EAEQC,MAAMA,CAACF,KAAoB;IACjC,IAAI,CAACA,KAAK,EAAE,OAAO,IAAI;IACvB,IAAI;MACF,MAAMc,OAAO,GAAGd,KAAK,CAACe,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;MACnC,MAAMC,IAAI,GAAGC,kBAAkB,CAC7BC,IAAI,CAACJ,OAAO,CAACK,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,CAACA,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC,CAChDJ,KAAK,CAAC,EAAE,CAAC,CACTK,GAAG,CAAEC,CAAC,IAAK,GAAG,GAAG,CAAC,IAAI,GAAGA,CAAC,CAACC,UAAU,CAAC,CAAC,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,EAAEC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CACjEC,IAAI,CAAC,EAAE,CAAC,CACZ;MACD,OAAOC,IAAI,CAACC,KAAK,CAACX,IAAI,CAAY;IACpC,CAAC,CAAC,MAAM;MACN,OAAO,IAAI;IACb;EACF;;;uBA9CWrB,WAAW;IAAA;EAAA;;;aAAXA,WAAW;MAAAiC,OAAA,EAAXjC,WAAW,CAAAkC,IAAA;MAAAC,UAAA,EADE;IAAM;EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}